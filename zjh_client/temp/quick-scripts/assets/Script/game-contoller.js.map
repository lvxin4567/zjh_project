{"version":3,"sources":["game-contoller.js"],"names":["EventListener","require","global","cc","Class","extends","Component","properties","main_world_prefab","default","type","Prefab","game_world_prefab","onLoad","socket","io","eventlistener","on","uid","console","log","emit","data","JSON","stringify","enterGameWorld","gameEventListener","fire","card_list","enterMainWorld","runningWorld","undefined","removeFromParent","instantiate","parent","node"],"mappings":"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","file":"game-contoller.js","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["var EventListener = require(\"./event-listener\");\r\nvar global = require(\"./global\");\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n       main_world_prefab: {\r\n           default: null,\r\n           type: cc.Prefab\r\n       },\r\n        game_world_prefab: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        }\r\n    },\r\n\r\n\r\n    // use this for initialization\r\n    onLoad: function () {\r\n        global.socket = io(\"localhost:3000\");\r\n        global.eventlistener = EventListener({});\r\n        global.eventlistener.on(\"login\", function (uid) {\r\n            console.log(\"button click uid= \" + uid);\r\n            global.socket.emit(\"login\", uid);\r\n        });\r\n        global.eventlistener.on(\"start_game\",  ()=> {\r\n            console.log(\"player house manager click start game\");\r\n            global.socket.emit(\"start_game\");\r\n        });\r\n\r\n        global.eventlistener.on(\"look_card\", ()=>{\r\n            global.socket.emit(\"look_card\");\r\n        });\r\n        global.eventlistener.on(\"player_choose_rate\", (data)=>{\r\n            global.socket.emit(\"player_choose_rate\", data);\r\n        });\r\n        global.eventlistener.on(\"pk_choose_player\", (uid)=>{\r\n            global.socket.emit(\"pk_choose_player\", uid);\r\n        });\r\n\r\n        global.socket.on(\"sync_data\",  (data)=> {\r\n            console.log(\"sync data = \" + JSON.stringify(data));\r\n            // global.player\r\n            this.enterGameWorld(data);\r\n        });\r\n        global.socket.on(\"player_join\", (data)=>{\r\n            global.gameEventListener.fire(\"player_join\", data);\r\n        });\r\n        global.socket.on(\"player_offline\", (uid)=>{\r\n            console.log(\"player off line = \" + uid);\r\n            global.gameEventListener.fire(\"player_offline\", uid);\r\n        });\r\n        global.socket.on(\"change_house_manager\", (uid)=>{\r\n           console.log(\"house manager is change\" + uid);\r\n            global.gameEventListener.fire(\"change_house_manager\", uid);\r\n        });\r\n        global.socket.on(\"push_card\", ()=>{\r\n            console.log(\"server send message push card\");\r\n            global.gameEventListener.fire(\"push_card\");\r\n        });\r\n        global.socket.on(\"show_card\", (card_list)=>{\r\n           global.gameEventListener.fire(\"show_card\", card_list);\r\n        });\r\n        global.socket.on(\"player_choose_rate\", (data)=>{\r\n            console.log(\"player choose rate = \" + JSON.stringify(data));\r\n           global.gameEventListener.fire(\"player_choose_rate\", data);\r\n        });\r\n        global.socket.on(\"turn_player_message\", (data)=>{\r\n           console.log(\"turn_player_message\" + JSON.stringify(data));\r\n            global.gameEventListener.fire(\"turn_player_message\", data);\r\n        });\r\n        global.socket.on(\"pk_result\", (data)=>{\r\n           console.log(\"pk result\" + JSON.stringify(data));\r\n            global.gameEventListener.fire(\"pk_result\", data);\r\n        });\r\n\r\n        this.enterMainWorld();\r\n    },\r\n    enterMainWorld: function () {\r\n        if (this.runningWorld != undefined){\r\n            this.runningWorld.removeFromParent(true);\r\n        }\r\n        this.runningWorld = cc.instantiate(this.main_world_prefab);\r\n        this.runningWorld.parent = this.node;\r\n    },\r\n    enterGameWorld: function (data) {\r\n        if (this.runningWorld != undefined){\r\n            this.runningWorld.removeFromParent(true);\r\n        }\r\n        this.runningWorld = cc.instantiate(this.game_world_prefab);\r\n        this.runningWorld.parent = this.node;\r\n        global.gameEventListener.fire(\"sync_data\", data);\r\n    }\r\n\r\n});\r\n"]}