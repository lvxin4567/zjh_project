{"version":3,"sources":["player-node.js"],"names":["cc","Class","extends","Component","properties","sprite_frames","default","type","SpriteFrame","uid_label","Label","house_manager_label","card_node_prefab","Prefab","card_pos","Node","choose_rate_label","choose_player_button","Button","pk_result_label","onLoad","node","active","addComponent","Sprite","spriteFrame","Math","round","random","length","gameEventListener","on","changeHouseManager","bind","pushCard","playerChooseRate","playerPK","pkchoosedPlayer","pkResult","console","log","uid","playerData","data","JSON","stringify","win_uid","string","lose_uid","rate","getUid","i","cardNode","instantiate","parent","scale","x","y","position","pAdd","index","p","init","house_manager_id","onDestroy","off","onButtonClick","event","customData","eventlistener","fire"],"mappings":"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","file":"player-node.js","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["import global from './global'\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n       sprite_frames: {\r\n           default: [],\r\n           type: cc.SpriteFrame\r\n       },\r\n        uid_label: {\r\n            default: null,\r\n            type: cc.Label\r\n        },\r\n        house_manager_label: {\r\n            default: null,\r\n            type: cc.Label\r\n        },\r\n        card_node_prefab: {\r\n            default: null,\r\n            type: cc.Prefab\r\n        },\r\n        card_pos: {\r\n            default: [],\r\n            type: cc.Node\r\n        },\r\n        choose_rate_label: {\r\n            default: null,\r\n            type: cc.Label\r\n        },\r\n        choose_player_button: {\r\n            default: null,\r\n            type: cc.Button\r\n        },\r\n        pk_result_label: {\r\n            default: null,\r\n            type: cc.Label\r\n        }\r\n    },\r\n\r\n    onLoad: function () {\r\n        this.choose_player_button.node.active = false;\r\n        this.node.addComponent(cc.Sprite).spriteFrame = this.sprite_frames[Math.round(Math.random() * this.sprite_frames.length)];\r\n\r\n        // const  changeHouseManager =  (uid) =>{\r\n        //     console.log(\"player node change house manager = \" + uid);\r\n        //     // this.house_manager_label.string = \"\";\r\n        //     this.house_manager_label.string = \"\";\r\n        //     if (uid === this.uid){\r\n        //         // this.house_manager_label.string = \"房主\";\r\n        //         this.house_manager_label.string = \"房主\";\r\n        //\r\n        //     }\r\n        // };\r\n\r\n        // global.gameEventListener.on(\"change_house_manager\", this.changeHouseManager);\r\n\r\n        global.gameEventListener.on(\"change_house_manager\", this.changeHouseManager.bind(this));\r\n        global.gameEventListener.on(\"push_card\",this.pushCard.bind(this));\r\n        global.gameEventListener.on(\"player_choose_rate\",this.playerChooseRate.bind(this));\r\n        global.gameEventListener.on(\"player_pk\",this.playerPK.bind(this));\r\n        global.gameEventListener.on(\"pk_choose_player\", this.pkchoosedPlayer.bind(this));\r\n        global.gameEventListener.on(\"pk_result\", this.pkResult.bind(this));\r\n    },\r\n    pkchoosedPlayer: function () {\r\n        this.choose_player_button.node.active = false;\r\n    },\r\n    playerPK: function () {\r\n        console.log(\"player node player pk\");\r\n        if (this.uid !== global.playerData.uid){\r\n            this.choose_player_button.node.active = true;\r\n        }\r\n    },\r\n    pkResult: function (data) {\r\n      console.log(\"player node pk result\" + JSON.stringify(data));\r\n      if (data.win_uid === this.uid){\r\n        this.pk_result_label.string = \"pk win\";\r\n      }else if (data.lose_uid === this.uid){\r\n        this.pk_result_label.string = \"pk lose\";\r\n      }\r\n    },\r\n    playerChooseRate: function (data) {\r\n        if (data.uid === this.uid){\r\n            this.choose_rate_label.string = data.rate;\r\n        }\r\n    },\r\n    pushCard: function () {\r\n        if (this.getUid() === global.playerData.uid){\r\n            return ;\r\n        }\r\n        for (let i = 0 ; i < 3 ; i ++){\r\n            let cardNode = cc.instantiate(this.card_node_prefab);\r\n            cardNode.parent = this.node;\r\n            cardNode.scale = {\r\n                x: 0.6,\r\n                y: 0.6\r\n            };\r\n            cardNode.position = cc.pAdd(this.card_pos[this.index].position,cc.p((3 - 1) * -0.5 * 40 + 40 * i, 0));\r\n\r\n\r\n        }\r\n    }\r\n    ,\r\n    changeHouseManager: function (uid) {\r\n        console.log(\"player node change house manager = \" + uid);\r\n        // this.house_manager_label.string = \"\";\r\n        this.house_manager_label.string = \"\";\r\n        if (uid === this.uid){\r\n            // this.house_manager_label.string = \"房主\";\r\n            this.house_manager_label.string = \"房主\";\r\n\r\n        }\r\n    },\r\n\r\n    init: function (uid, index) {\r\n        this.uid = uid;\r\n        this.index = index;\r\n        this.uid_label.string = uid + \"\";\r\n        if (global.playerData.house_manager_id === this.uid){\r\n            this.house_manager_label.string = \"房主\";\r\n        }\r\n    }\r\n    ,\r\n    getUid: function () {\r\n        return this.uid;\r\n    },\r\n    onDestroy: function () {\r\n        console.log(\"destroy\");\r\n        // global.gameEventListener.off(\"changeHouseManager\", this.changeHouseManager);\r\n        global.gameEventListener.off(\"change_house_manager\", this.changeHouseManager);\r\n        global.gameEventListener.off(\"push_card\", this.pushCard);\r\n        global.gameEventListener.off(\"player_choose_rate\",this.playerChooseRate);\r\n        global.gameEventListener.off(\"player_pk\",this.playerPK);\r\n        global.gameEventListener.off(\"pk_choose_player\", this.pkchoosedPlayer);\r\n        global.gameEventListener.off(\"pk_result\", this.pkResult);\r\n    },\r\n\r\n    onButtonClick: function (event, customData) {\r\n        if (customData === \"choose_player_button\"){\r\n            cc.log(\"choose me =\" + this.uid);\r\n            global.eventlistener.fire(\"pk_choose_player\", this.uid);\r\n            global.gameEventListener.fire(\"pk_choose_player\");\r\n        }\r\n    }\r\n\r\n});\r\n"]}