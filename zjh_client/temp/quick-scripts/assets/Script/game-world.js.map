{"version":3,"sources":["game-world.js"],"names":["cc","Class","extends","Component","properties","player_node_prefab","default","type","Prefab","player_pos_list","Node","game_ready_ui","onLoad","_index","playerNodeList","active","gameEventListener","on","data","console","log","JSON","stringify","playerData","uid","house_manager_id","_playersData","players_data","index","i","length","createPlayer","playerNode","getComponent","getUid","removeFromParent","destroy","splice","currentIndex","player","instantiate","parent","node","init","position","push","onButtonClick","event","customData","eventlistener","fire"],"mappings":"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","file":"game-world.js","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["import global from './global'\r\nimport EventListener from './event-listener'\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n       player_node_prefab: {\r\n           default: null,\r\n           type: cc.Prefab\r\n       },\r\n        player_pos_list: {\r\n            default: [],\r\n            type:cc.Node\r\n        },\r\n        game_ready_ui: {\r\n            default: null,\r\n            type: cc.Node\r\n        }\r\n    },\r\n\r\n\r\n    onLoad: function () {\r\n        this._index = 0;\r\n        this.playerNodeList = [];\r\n        this.game_ready_ui.active = false;\r\n        global.gameEventListener = EventListener({});\r\n        global.gameEventListener.on(\"sync_data\",  (data)=> {\r\n            console.log(\"game world sync data = \" + JSON.stringify(data));\r\n            global.playerData.uid = data.uid;\r\n            global.playerData.house_manager_id = data.house_manager_id;\r\n            console.log(\"house manager = \" + data.house_manager_id);\r\n            if ( data.uid === data.house_manager_id){\r\n                this.game_ready_ui.active = true;\r\n            }\r\n            var _playersData = data.players_data;\r\n            this._index = data.index;\r\n\r\n            for (var i = 0 ; i < _playersData.length ; i ++){\r\n                var playerData = _playersData[i];\r\n                this.createPlayer(playerData.uid, playerData.index);\r\n            }\r\n        });\r\n        global.gameEventListener.on(\"player_join\", (data)=>{\r\n            this.createPlayer(data.uid, data.index);\r\n        });\r\n        global.gameEventListener.on(\"player_offline\", (uid)=>{\r\n            for (var i = 0 ; i < this.playerNodeList.length ; i ++){\r\n                var playerNode = this.playerNodeList[i];\r\n                if (playerNode.getComponent(\"player-node\").getUid() === uid){\r\n                    playerNode.removeFromParent(true);\r\n                    playerNode.destroy();\r\n                    this.playerNodeList.splice(i, 1);\r\n                }\r\n            }\r\n        });\r\n        global.gameEventListener.on(\"change_house_manager\", (uid)=>{\r\n            global.playerData.house_manager_id = uid;\r\n            if (global.playerData.uid === uid){\r\n                this.game_ready_ui.active = true;\r\n            }\r\n        });\r\n        global.gameEventListener.on(\"push_card\", ()=>{\r\n           this.game_ready_ui.active = false;\r\n        });\r\n    },\r\n    createPlayer: function (uid, index) {\r\n        console.log(\"uid = \" + uid);\r\n        console.log(\"index = \" + index);\r\n        var currentIndex = index - this._index;\r\n        if (currentIndex < 0){\r\n            currentIndex = currentIndex + 6;\r\n        }\r\n        var player = cc.instantiate(this.player_node_prefab);\r\n        player.parent = this.node;\r\n        player.getComponent(\"player-node\").init(uid, currentIndex);\r\n        player.position = this.player_pos_list[currentIndex].position;\r\n        this.playerNodeList.push(player);\r\n    },\r\n    onButtonClick: function (event , customData) {\r\n        console.log(\"customData = \" + customData);\r\n\r\n        switch (customData){\r\n            case \"start_game\":\r\n                global.eventlistener.fire(\"start_game\");\r\n                break;\r\n            case \"lookcard\":\r\n                global.eventlistener.fire(\"look_card\");\r\n                break;\r\n            case \"rate_1\":\r\n                global.eventlistener.fire(\"player_choose_rate\", 1);\r\n                break;\r\n            case \"rate_2\":\r\n                global.eventlistener.fire(\"player_choose_rate\", 2);\r\n\r\n                break;\r\n            case \"rate_5\":\r\n                global.eventlistener.fire(\"player_choose_rate\", 5);\r\n\r\n                break;\r\n            case \"pk_button\":\r\n                global.gameEventListener.fire(\"player_pk\");\r\n                break;\r\n            default:\r\n                break;\r\n        }\r\n    }\r\n\r\n\r\n});\r\n"]}