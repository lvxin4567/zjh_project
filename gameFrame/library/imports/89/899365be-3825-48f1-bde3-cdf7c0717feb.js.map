{"version":3,"sources":["..\\..\\..\\..\\assets\\Script/assets\\Script\\http.js"],"names":["sendhttp","PostURL","url","data","func","otherdata","errorhandle","xhr","cc","loader","getXMLHttpRequest","open","log","setRequestHeader","onreadystatechange","status","readyState","httpStatus","statusText","buffer","response","send","head","JSON","stringify","jsonData","_this","timesend","Date","valueOf","toString","globleData","baseurl","encodeURI","str","recvdata","parse","msgsign","encode","Uint8Array","BASE64","decoder","msgdata","Bytes2Str","pako","inflate","msghead"],"mappings":";;;;;;;;;QAiCgBA,WAAAA;AAjChB;;;AAGA,IAAIC,UAAU,SAAVA,OAAU,CAAUC,GAAV,EAAcC,IAAd,EAAmBC,IAAnB,EAAwBC,SAAxB,EAAkCC,WAAlC,EAA+C;AACzD,QAAIC,MAAMC,GAAGC,MAAH,CAAUC,iBAAV,EAAV;AACAH,QAAII,IAAJ,CAAS,MAAT,EAAiBT,GAAjB;;AAEAM,OAAGI,GAAH,CAAO,kBAAgBV,GAAvB;;AAEA;AACA;AACAK,QAAIM,gBAAJ,CAAqB,cAArB,EAAoC,0BAApC;AACA;AACAN,QAAIF,SAAJ,GAAgBA,SAAhB;AACAE,QAAIO,kBAAJ,GAAyB,YAAY;AACjC,YAAGP,IAAIQ,MAAJ,IAAc,GAAjB,EAAsB;AAClB,gBAAGR,IAAIS,UAAJ,IAAkB,CAArB,EAAwB;AACpB,oBAAIC,aAAaV,IAAIW,UAArB;AACA,oBAAIC,SAASZ,IAAIa,QAAjB;;AAEAhB,qBAAKe,MAAL,EAAaZ,IAAIF,SAAjB;AACH;AACJ,SAPD,MAOO;AACHG,eAAGI,GAAH,CAAO,eAAP;AACA,gBAAGN,eAAe,IAAlB,EACIA,YAAYC,IAAIF,SAAhB;AACP;AACJ,KAbD;;AAeAE,QAAIc,IAAJ,CAASlB,IAAT;AAEH,CA5BD;;AA8BO,SAASH,QAAT,CAAkBsB,IAAlB,EAAwBnB,IAAxB,EAA8BC,IAA9B,EAAmC;AACtC,QAAIgB,WAAW,EAAC,WAAWE,IAAZ,EAAkB,WAAWC,KAAKC,SAAL,CAAerB,IAAf,CAA7B,EAAf;AACA,QAAIsB,WAAWF,KAAKC,SAAL,CAAeJ,QAAf,CAAf;AACAZ,OAAGI,GAAH,CAAO,mBAAmBa,QAA1B;AACA,QAAIC,QAAQ,IAAZ;AACA;AACA,QAAIC,WAAa,IAAIC,IAAJ,EAAD,CAAaC,OAAb,EAAD,CAAyBC,QAAzB,EAAf;AACA7B,YAAQ,YAAY8B,WAAWC,OAAvB,GAAiC,YAAjC,GAAgDC,UAAU,aAAaR,QAAvB,CAAxD,EAA0F,EAA1F,EAA8F,UAAUS,GAAV,EAAe;AACzG1B,WAAGI,GAAH,CAAOsB,GAAP;AACA,YAAI9B,QAAQ,IAAZ,EAAkB;AACd,gBAAI+B,WAAWZ,KAAKa,KAAL,CAAWF,GAAX,CAAf;AACA,gBAAIG,UAAUd,KAAKa,KAAL,CAAWD,SAASE,OAApB,CAAd;AACA,gBAAIA,QAAQC,MAAR,IAAkBD,QAAQC,MAAR,IAAkB,CAAxC,EAA2C;AACvC,oBAAInC,OAAO,IAAIoC,UAAJ,CAAeC,OAAOC,OAAP,CAAeN,SAASO,OAAxB,CAAf,CAAX;AACAP,yBAASO,OAAT,GAAmBC,UAAUC,KAAKC,OAAL,CAAa1C,IAAb,CAAV,CAAnB;AACH;AACD,gBAAIgC,SAASW,OAAT,IAAoB,KAAxB,EAA+B;AAC3B;AACA;AACA,oBAAI3C,OAAOoB,KAAKa,KAAL,CAAWD,SAASO,OAApB,CAAX;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACH,aAXD,MAWO,IAAGP,SAASW,OAAT,IAAoB,SAAvB,EAAkC;AACrC;AACA;AACA;AACH,aAJM,MAIA;AACH1C,qBAAKmB,KAAKa,KAAL,CAAWD,SAASO,OAApB,CAAL,EAAmC,EAAnC,EAAuCP,QAAvC;AACH;AACJ;AACD;AACA;AACH,KA9BD,EA8BG,IA9BH,EA8BS,UAAUD,GAAV,EAAe;AACpB;AACA;AACH,KAjCD;AAkCH","file":"http.js","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["/**\r\n * Created by Administrator on 2018-4-16.\r\n */\r\nvar PostURL = function (url,data,func,otherdata,errorhandle) {\r\n    var xhr = cc.loader.getXMLHttpRequest();\r\n    xhr.open(\"POST\", url);\r\n\r\n    cc.log(\"postUrl,url==\"+url)\r\n\r\n    //set Content-type \"text/plain;charset=UTF-8\" to post plain text\r\n    //xhr.setRequestHeader(\"Content-Type\",\"text/plain\");\r\n    xhr.setRequestHeader(\"Content-Type\",\"text/plain;charset=UTF-8\");\r\n    //xhr.responseType = \"arraybuffer\";\r\n    xhr.otherdata = otherdata;\r\n    xhr.onreadystatechange = function () {\r\n        if(xhr.status == 200) {\r\n            if(xhr.readyState == 4) {\r\n                var httpStatus = xhr.statusText;\r\n                var buffer = xhr.response;\r\n\r\n                func(buffer, xhr.otherdata);\r\n            }\r\n        } else {\r\n            cc.log(\"PostURL error\");\r\n            if(errorhandle != null)\r\n                errorhandle(xhr.otherdata);\r\n        }\r\n    };\r\n\r\n    xhr.send(data);\r\n\r\n};\r\n\r\nexport function sendhttp(head, data, func){\r\n    var response = {\"msghead\": head, \"msgdata\": JSON.stringify(data)};\r\n    var jsonData = JSON.stringify(response);\r\n    cc.log(\"sendHttp::::::\" + jsonData);\r\n    var _this = this;\r\n    // LA 20161213 网络延时\r\n    var timesend = ((new Date()).valueOf()).toString();\r\n    PostURL(\"http://\" + globleData.baseurl + \"/loginmsg?\" + encodeURI(\"msgdata=\" + jsonData), \"\", function (str) {\r\n        cc.log(str);\r\n        if (func != null) {\r\n            var recvdata = JSON.parse(str);\r\n            var msgsign = JSON.parse(recvdata.msgsign);\r\n            if (msgsign.encode && msgsign.encode == 1) {\r\n                var data = new Uint8Array(BASE64.decoder(recvdata.msgdata));\r\n                recvdata.msgdata = Bytes2Str(pako.inflate(data));\r\n            }\r\n            if (recvdata.msghead == \"err\") {\r\n                //_this.game.uimgr.showload(false);\r\n                //_this.game.uimgr.showui(\"gameclass.msgboxui\");\r\n                var data = JSON.parse(recvdata.msgdata);\r\n                //if (data.info.toString() == \"当前版本号过低，请下载最新版本进行游戏\") {\r\n                //    _this.game.uimgr.uis[\"gameclass.msgboxui\"].setString(data.info, function () {\r\n                //        gameclass.mod_platform.openurl(gameclass.download);\r\n                //    });\r\n                //} else {\r\n                //    _this.game.uimgr.uis[\"gameclass.msgboxui\"].setString(data.info);\r\n                //}\r\n            } else if(recvdata.msghead == \"updcard\") {\r\n                //cc.log(\"http:::updcard\");\r\n                //var data = JSON.parse(recvdata.msgdata);\r\n                //_this.game.modmgr.mod_login.setLoginData(data.card - data.gold, data.gold)\r\n            } else {\r\n                func(JSON.parse(recvdata.msgdata), \"\", recvdata);\r\n            }\r\n        }\r\n        // {\"msghead\":\"login\",\"msgsign\":\"\",\"msgdata\":\"{\\\"openid\\\":\\\"0f7c62d9876a875f0a60503319b3b8e0\\\",\\\"name\\\":\\\"游客\\\",\\\"imgurl\\\":\\\"\\\",\\\"card\\\":8,\\\"ip\\\":\\\"\\\",\\\"room\\\":0}\"}\r\n        //{\"msghead\":\"login\",\"msgsign\":\"\",\"msgdata\":\"{\\\"openid\\\":\\\"0f7c62d9876a875f0a60503319b3b8e0\\\",\\\"name\\\":\\\"游客\\\",\\\"imgurl\\\":\\\"\\\",\\\"card\\\":7,\\\"ip\\\":\\\"http://120.24.215.214:8091/servermsg\\\",\\\"room\\\":150005}\"}\r\n    }, null, function (str) {\r\n        //_this.game.uimgr.showui(\"gameclass.msgboxui\");\r\n        //_this.game.uimgr.uis[\"gameclass.msgboxui\"].setString(\"网络连接失败,请检查网络是否通畅\");\r\n    });\r\n}\r\n\r\n"]}