{"version":3,"sources":["..\\..\\..\\..\\assets\\Script/assets\\Script\\socketBase.js"],"names":["cc","Class","extends","Component","properties","websocketTarget","onLoad","_loginHandler","url","log","WebSocket","ws","binaryType","_this","onopen","onclose","onerror","evt","onmessage","u8a","Uint8Array","data","str","Bytes2Str","recvdata","JSON","parse","msgsign","curservrtime","time","curclienttime","Math","floor","Date","getTime","encode","BASE64","decoder","msgdata","pako","inflate","msghead","_calldata","onmsg_OtherHead","sendSocket","response","headName","stringify","obj","jsonData","send"],"mappings":";;;;;;AAAA;;;;AAIAA,GAAGC,KAAH,CAAS;AACLC,aAAQF,GAAGG,SADN;;AAGLC,gBAAW;AACPC,yBAAgB;AADT,KAHN;;AAOLC,YAAO,kBAAU;AACb,aAAKD,eAAL,GAAuB,IAAvB;AACH,KATI;;AAWLE,mBAAc,uBAASC,GAAT,EAAa;AACvBR,WAAGS,GAAH,CAAO,kCAAkCD,GAAzC;AACA,YAAG,CAAC,KAAKH,eAAT,EAAyB;AACrB,iBAAKA,eAAL,GAAuB,IAAIK,SAAJ,CAAc,UAASF,GAAvB,CAAvB;AACH;AACD,YAAIG,KAAK,KAAKN,eAAd;AACAM,WAAGC,UAAH,GAAgB,aAAhB;AACA,YAAIC,QAAQ,IAAZ;AACAF,WAAGG,MAAH,GAAY,YAAU;AAClBd,eAAGS,GAAH,CAAO,eAAaD,GAAb,GAAiB,UAAxB;AACH,SAFD;AAGAG,WAAGI,OAAH,GAAa,YAAU,CAEtB,CAFD;AAGAJ,WAAGK,OAAH,GAAa,UAASC,GAAT,EAAa,CAEzB,CAFD;AAGAN,WAAGO,SAAH,GAAe,UAASD,GAAT,EAAa;AACxB,gBAAIE,MAAM,IAAIC,UAAJ,CAAeH,IAAII,IAAnB,CAAV;AACA,gBAAIC,MAAMC,UAAUJ,GAAV,CAAV;;AAEA,gBAAIK,WAAWC,KAAKC,KAAL,CAAWJ,GAAX,CAAf;AACA,gBAAIK,UAAUF,KAAKC,KAAL,CAAWF,SAASG,OAApB,CAAd;;AAEAd,kBAAMe,YAAN,GAAqBD,QAAQE,IAA7B;AACAhB,kBAAMiB,aAAN,GAAsBC,KAAKC,KAAL,CAAW,IAAIC,IAAJ,GAAWC,OAAX,KAAqB,IAAhC,CAAtB;;AAEA,gBAAGP,QAAQQ,MAAR,IAAkBR,QAAQQ,MAAR,IAAkB,CAAvC,EAA0C;AACtC,oBAAId,OAAO,IAAID,UAAJ,CAAegB,OAAOC,OAAP,CAAeb,SAASc,OAAxB,CAAf,CAAX;AACAd,yBAASc,OAAT,GAAmBf,UAAUgB,KAAKC,OAAL,CAAanB,IAAb,CAAV,CAAnB;AACH;AACD,gBAAGG,SAASiB,OAAT,IAAkB,UAArB,EAAgC;AAC5BzC,mBAAGS,GAAH,CAAOe,SAASc,OAAhB;AACAtC,mBAAGS,GAAH,CAAOe,QAAP;AACH;AACD,gBAAIkB,YAAUjB,KAAKC,KAAL,CAAWF,SAASc,OAApB,CAAd;AACA,gBAAGzB,MAAM,WAASW,SAASiB,OAAxB,CAAH,EAAoC;AAChC5B,sBAAM,WAASW,SAASiB,OAAxB,EAAiCC,SAAjC;AACH,aAFD,MAEK;AACD7B,sBAAM8B,eAAN,CAAsBnB,SAASiB,OAA/B,EAAuCC,SAAvC;AACH;AACJ,SAxBD;AAyBH,KArDI;;AAuDLE,gBAAW,oBAASvB,IAAT,EAAc;AACrB,YAAIwB,WAAU,EAAC,WAAUxB,KAAKyB,QAAhB,EAAyB,WAAUrB,KAAKsB,SAAL,CAAe1B,KAAK2B,GAApB,CAAnC,EAAd;AACA,YAAIC,WAAWxB,KAAKsB,SAAL,CAAeF,QAAf,CAAf;AACA,YAAG,KAAKxC,eAAR,EAAwB;AACpB,iBAAKA,eAAL,CAAqB6C,IAArB,CAA0BD,QAA1B;AACH;AACJ,KA7DI;AA8DLN,mBA9DK,2BA8DWF,OA9DX,EA8DmBC,SA9DnB,EA8D6B,CAEjC;AAhEI,CAAT","file":"socketBase.js","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["/**\r\n * Created by Administrator on 2018-4-18.\r\n */\r\n\r\ncc.Class({\r\n    extends:cc.Component,\r\n\r\n    properties:{\r\n        websocketTarget:null,\r\n    },\r\n\r\n    onLoad:function(){\r\n        this.websocketTarget = null;\r\n    },\r\n\r\n    _loginHandler:function(url){\r\n        cc.log(\"create socket ip=============\" + url);\r\n        if(!this.websocketTarget){\r\n            this.websocketTarget = new WebSocket(\"ws://\"+ url);\r\n        }\r\n        var ws = this.websocketTarget;\r\n        ws.binaryType = 'arraybuffer';\r\n        var _this = this;\r\n        ws.onopen = function(){\r\n            cc.log('websocket:'+url+' connect');\r\n        };\r\n        ws.onclose = function(){\r\n\r\n        };\r\n        ws.onerror = function(evt){\r\n\r\n        };\r\n        ws.onmessage = function(evt){\r\n            var u8a = new Uint8Array(evt.data);\r\n            var str = Bytes2Str(u8a);\r\n\r\n            var recvdata = JSON.parse(str);\r\n            var msgsign = JSON.parse(recvdata.msgsign);\r\n\r\n            _this.curservrtime = msgsign.time;\r\n            _this.curclienttime = Math.floor(new Date().getTime()/1000);\r\n\r\n            if(msgsign.encode && msgsign.encode == 1) {\r\n                var data = new Uint8Array(BASE64.decoder(recvdata.msgdata));\r\n                recvdata.msgdata = Bytes2Str(pako.inflate(data));\r\n            }\r\n            if(recvdata.msghead!=\"gameping\"){\r\n                cc.log(recvdata.msgdata);\r\n                cc.log(recvdata);\r\n            }\r\n            var _calldata=JSON.parse(recvdata.msgdata);\r\n            if(_this[\"onmsg_\"+recvdata.msghead]){\r\n                _this[\"onmsg_\"+recvdata.msghead](_calldata);\r\n            }else{\r\n                _this.onmsg_OtherHead(recvdata.msghead,_calldata);\r\n            }\r\n        };\r\n    },\r\n\r\n    sendSocket:function(data){\r\n        var response ={\"msghead\":data.headName,\"msgdata\":JSON.stringify(data.obj)};\r\n        var jsonData = JSON.stringify(response);\r\n        if(this.websocketTarget){\r\n            this.websocketTarget.send(jsonData)\r\n        }\r\n    },\r\n    onmsg_OtherHead(msghead,_calldata){\r\n\r\n    },\r\n\r\n\r\n})\r\n\r\n"]}