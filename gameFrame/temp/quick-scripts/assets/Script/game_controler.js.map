{"version":3,"sources":["game_controler.js"],"names":["EventListener","require","cc","Class","extends","Component","properties","onLoad","globleData","rootNode","node","enterLogin","getComponent","showui","enterHall","jionroom","ip","roomid","getroominfo","ws","data","func","_connect","setLogindata","card","gold","logindata","updateUIMsg","guestlogin","_code","clientver","retdata","temp","recvdata","log","msgdata","room","closeallui","center","bind","creategoldroom","gametype","num","_num","uid","code","_this"],"mappings":"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","file":"game_controler.js","sourceRoot":"..\\..\\..\\..\\assets\\Script","sourcesContent":["var EventListener = require('./event_listener')\r\nimport {sendhttp} from './http'\r\n\r\ncc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n\r\n    },\r\n\r\n    onLoad:function(){\r\n        globleData.rootNode = this.node;\r\n        this.enterLogin();\r\n    },\r\n\r\n    enterLogin:function(){\r\n        globleData.rootNode.getComponent('uiManager').showui('loginscene');\r\n    },\r\n\r\n    enterHall:function(){\r\n        globleData.rootNode.getComponent('uiManager').showui('hallScene');\r\n    },\r\n\r\n    jionroom:function(ip, roomid){\r\n        this.getroominfo(\"ws://\"+ip,roomid,function(ws,data){\r\n\r\n        })\r\n\r\n    },\r\n    getroominfo:function(ip, roomid,func){\r\n        this.node.getComponent('gameSocket')._connect(ip,func);\r\n    },\r\n\r\n    setLogindata:function(card,gold){\r\n        globleData.logindata.card = card;\r\n        globleData.logindata.gold = gold;\r\n        globleData.rootNode.getComponent('uiManager').updateUIMsg(\"updcard\");\r\n    },\r\n\r\n    guestlogin:function(_code){\r\n        var data = {\"code\": _code, \"ver\": globleData.clientver};\r\n        sendhttp(\"loginYK\",data,function(retdata, temp, recvdata){\r\n            cc.log(retdata);\r\n            if(recvdata.msgdata == \"loginfail\"){\r\n\r\n            }else{\r\n                globleData.logindata = retdata;\r\n                if(retdata.room == 0){\r\n                    this.node.getComponent('uiManager').closeallui();\r\n                    this.enterHall();\r\n                }else{\r\n                    this.jionroom(retdata.ip, retdata.room);\r\n                }\r\n                this.node.getComponent('centerSocket')._connect(retdata.center);\r\n            }\r\n        }.bind(this));\r\n    },\r\n\r\n    creategoldroom:function(gametype , num){\r\n        var _num = 1;\r\n        if (num) _num = num;\r\n        var data = {\"uid\": globleData.logindata.uid, \"type\": gametype, \"num\": _num,\"unionid\":globleData.code};\r\n        var _this = this;\r\n        sendhttp('fastjoin',data,function(retdata, temp, recvdata){\r\n            if(recvdata.card){\r\n                _this.setLogindata(retdata.card - retdata.gold, retdata.gold);\r\n            }\r\n            _this.jionroom(retdata.ip, retdata.room);\r\n        })\r\n    },\r\n\r\n\r\n\r\n\r\n    // update (dt) {},\r\n});\r\n"]}